 SELECT "Leave".id,
    requester.id AS requester_id,
    requester.full_name AS requester_name,
    requester.employee_id AS requester_emp_id,
    "Leave".leave_start_date AS start_date,
    "Leave".leave_end_date AS end_date,
        CASE
            WHEN "Leave".approval_one_status = false THEN 'Rejected'::text
            WHEN "Leave".approval_one_status IS NULL THEN 'Waiting for Validation'::text
            ELSE 'Rejected'::text
        END AS approval_one_status,
        CASE
            WHEN "Leave".approval_two_status = false THEN 'Rejected'::text
            WHEN "Leave".approval_two_status IS NULL THEN 'Waiting for Validation'::text
            ELSE 'Rejected'::text
        END AS approval_two_status,
        CASE
            WHEN "Leave".approval_three_status = false THEN 'Rejected'::text
            WHEN "Leave".approval_three_status IS NULL THEN 'Waiting for Validation'::text
            ELSE 'Rejected'::text
        END AS approval_three_status,
    "Leave".description,
    "Leave".attachment,
    "Leave"."LeaveTypeId",
    "ApprovalTemplate".approver_one,
    "ApprovalTemplate".approver_two,
    "ApprovalTemplate".approver_three,
    approver_one.full_name AS approver_one_name,
    approver_two.full_name AS approver_two_name,
    approver_three.full_name AS approver_three_name,
        CASE
            WHEN "Leave".approval_one_status IS NULL THEN approver_one.id
            WHEN "Leave".approval_two_status IS NULL THEN approver_two.id
            WHEN "Leave".approval_three_status IS NULL THEN approver_three.id
            ELSE NULL::integer
        END AS approver_now,
        CASE
            WHEN approver_three.full_name IS NOT NULL THEN
            CASE
                WHEN "Leave".approval_one_status = false THEN 'Rejected'::text
                WHEN "Leave".approval_one_status IS NULL THEN 'Waiting for Validation'::text
                ELSE
                CASE
                    WHEN "Leave".approval_two_status = false THEN 'Rejected'::text
                    WHEN "Leave".approval_two_status IS NULL THEN 'Waiting for Validation'::text
                    ELSE
                    CASE
                        WHEN "Leave".approval_three_status = false THEN 'Rejected'::text
                        WHEN "Leave".approval_three_status IS NULL THEN 'Waiting for Validation'::text
                        ELSE 'Approved'::text
                    END
                END
            END
            WHEN approver_two.full_name IS NOT NULL THEN
            CASE
                WHEN "Leave".approval_one_status = false THEN 'Rejected'::text
                WHEN "Leave".approval_one_status IS NULL THEN 'Waiting for Validation'::text
                ELSE
                CASE
                    WHEN "Leave".approval_two_status = false THEN 'Rejected'::text
                    WHEN "Leave".approval_two_status IS NULL THEN 'Waiting for Validation'::text
                    ELSE 'Approved'::text
                END
            END
            ELSE
            CASE
                WHEN "Leave".approval_one_status = false THEN 'Rejected'::text
                WHEN "Leave".approval_one_status IS NULL THEN 'Waiting for Validation'::text
                ELSE 'Approved'::text
            END
        END AS last_status
   FROM "Leave"
     LEFT JOIN "User" requester ON requester.id = "Leave"."UserId"
     LEFT JOIN "Role" ON "Role".id = requester."RoleId"
     LEFT JOIN "LeaveType" ON "LeaveType".id = "Leave"."LeaveTypeId"
     LEFT JOIN "ApprovalAuthorization" ON "Role".id = "ApprovalAuthorization"."RoleId"
     LEFT JOIN "ApprovalTemplate" ON "ApprovalAuthorization"."ApprovalTemplateId" = "ApprovalTemplate".id
     LEFT JOIN "User" approver_one ON approver_one.id = "ApprovalTemplate".approver_one
     LEFT JOIN "User" approver_two ON approver_two.id = "ApprovalTemplate".approver_two
     LEFT JOIN "User" approver_three ON approver_three.id = "ApprovalTemplate".approver_three
  WHERE "Leave".deleted_at IS NULL AND "ApprovalTemplate".deleted_at IS NULL AND "ApprovalAuthorization".deleted_at IS NULL